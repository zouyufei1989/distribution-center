<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Order">

	<sql id="tableName">d_order</sql>

	<select id="selectSearchList" parameterType="Map" resultType="Order">
		SELECT
			id,
			batch_id AS batchId,
			customer_group_id AS customerGroupId,
			goods_id AS goodsId,
			order_price AS orderPrice,
			status
		FROM <include refid="tableName"/>
		WHERE
			status != -2
			<if test="order.batchId!=null and order.batchId!=''">
				AND batch_id = #{order.batchId}
			</if>
		<if test="rows != null and  rows > 0">
			LIMIT #{start}, #{rows}
		</if>
	</select>

	<select id="findById" parameterType="String" resultType="Order">
		SELECT
			batch_id,
			customer_group_id,
			goods_id,
			goods_name,
			goods_combine,
			goods_type_id,
			goods_type_name,
			expire_date,
			goods_desc,
			goods_cnt,
			goods_item_type_cnt,
			goods_sum_price,
			order_price,
			order_cnt,
			status
		FROM <include refid="tableName"/>
		WHERE id = #{id}
	</select>

	<insert id="add" parameterType="Order" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO <include refid="tableName"/>
		(
			batch_id,
			customer_group_id,
			goods_id,
			goods_name,
			goods_combine,
			goods_type_id,
			goods_type_name,
			expire_date,
			goods_desc,
			goods_cnt,
			goods_item_type_cnt,
			goods_sum_price,
			order_price,
			order_cnt,
			status,
			create_date,
			creator,
			create_ip
		)
		VALUES 
		(
			#{batchId},
			#{customerGroupId},
			#{goodsId},
			#{goodsName},
			#{goodsCombine},
			#{goodsTypeId},
			#{goodsTypeName},
			#{expireDate},
			#{goodsDesc},
			#{goodsCnt},
			#{goodsItemTypeCnt},
			#{goodsSumPrice},
			#{orderPrice},
			#{orderCnt},
			#{status},
			NOW(),
		  	#{creator},
		  	#{createIp}
		)
	</insert>

	<update id="changeStatus" parameterType="Map">
		UPDATE <include refid="tableName"/>
		SET
			update_date = NOW()
			,updater = #{updater}
			,status = #{status}
		WHERE
			id IN
			<foreach collection="ids" item="id" open="(" close=")" separator=",">
				#{id}
			</foreach>
 	</update>

</mapper>